#!/usr/bin/env bash
# -*- bash -*-
#
cmd="$1"
full_cmd="$@"
set -u -e -o pipefail

mods=( Customer Screen_Name Uni Contact IM );

export DUCK_TEMPLATE=$(pwd)/Server/App/duck_template.js
bin="$(pwd)/node_modules/duck_duck_duck/bin/duck_duck_duck"


if [[ "$cmd" == "" ]]
then
  cmd="up"
  full_cmd="up $full_cmd"
fi


if [[ "$cmd" == "create" ]]
then

  if [[ ! "${mods[@]}" == *"$2"* ]]
  then
    echo "$2 not in list."
    exit 1
  fi

  cd "Server/$2"
  $bin create $3
  cd ../..

else

  if [[ "$cmd" == "down" ]]
  then
    if [ ! -n "${IS_DEV+x}" ]
    then
      echo "This is not a dev machine."
      exit 1
    fi
  else
    if [[ ! "$cmd" == "up" ]]
    then
      echo "Unknown command: $cmd"
      exit 1
    fi
  fi

  for m in "${mods[@]}"
  do
    cd "Server/$m"
    echo "$m"
    $bin $full_cmd
    cd ../..
  done

fi

